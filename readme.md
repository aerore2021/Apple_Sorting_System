# 苹果检测实验
## Introduction
Hello, 这是一个结合图像处理和深度学习的苹果分拣系统，我们实现了针对摄像头直播流的苹果尺寸实时测算、虫蛀检测和新鲜度判断。   
#### 苹果尺寸测算和虫蛀检测
基于OpenCV-Python库，我们对原始图像进行**高斯模糊、灰度化、二值化、开运算**，并对结果通过**canny算子提取边缘**后，`find_contours()`会提取闭合边缘为**轮廓**，最终得到苹果的轮廓和尺寸，以及可能的虫蛀。
> *然而我们的参数是camera-specific的，意味着你需要根据自己的摄像头和实验环境进行参数的调整，更有甚者，对处理过程进行删增。*
#### 苹果新鲜度判断
传统上我们对苹果新鲜度的判断指标是RGB/HSV通道中红色、黄色色彩的比例，但似乎有些先入为主了，因为根据某农学专业的同学所说，不同种的苹果成熟颜色是不一样的，甚至差异很大。 
因此我们选择让ResNet自己学习能够用来判断苹果成熟度的特征。    
> *当然，成熟度是人工标注的，这免不了出现偏差和偏见。如果有更对口的数据集就再好不过了。*

模型最终有两个输出：fully-ripe和fine-ripe，是因为我们实验验收的时候只能买到成熟或者相对成熟的苹果，因此粒度并没有那么细。
#### 基于PyQt5的GUI
有了PyQt的工具以后，实现一个简单的图形界面是很容易的事情。*入门的成本也就一个晚上左右*，所以尽管以前没有尝试过用Python编写GUI的同学，我还是很推荐去尝试一下。   
难点可能就在怎么把OpenCV的捕获接在GUI里，网上有相关的基础教程；至于如何把图像处理呈现出来之类的进阶功能，就是我们自己的创新了。
> 最麻烦的其实是从CLI转向GUI时的代码重构，但是项目总是这样一步步升级的，很难从一开始就决定要实现成什么样子。
## Installation
程序运行之前先在终端运行命令`pip install -r requirements.txt` 以确保没有缺失包且版本一致。

## How to use
在终端运行命令`python main.py`
> 如果想要本地训练模型，删掉"apple_model.pth"(模型权重文件)即可
> 模型微调在train_model.py里
> OpenCV相关的操作在measure_diameter.py里
> 另外两个py文件各有主函数接口，是用于调式对应功能的，一般不运行

